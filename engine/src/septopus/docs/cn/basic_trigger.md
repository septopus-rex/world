# 触发器说明

* 触发器在**正常模式**中的主要作用，是实现环境和玩家的互动。
* 触发器在**游戏模式**中的主要作用，是现实游戏的逻辑。
* 触发器在**鬼魂模式**中不起作用。
* 触发通过对以下各种类型的对象进行读取来实现功能。
    1. 附属物
    2. 玩家属性
    3. 系统环境
    4. 背包系统
* 触发器很容易存在逻辑漏洞，需要对读写进行权限控制。属性的修改，需区分不同的模式。

## 属性及对象选择

* 触发器需要对执行的对象进行选取，采用统一格式来进行实现。
* 选择数组不存在属性选择的时候，就是对象选择。
* 选择的主要类型为["系统","附属物","玩家","背包"]。

```Javascript
    
```

```Javascript
    {
        "SELECTION_SYSTEM":0,
        "SELECTION_ADJUNCT":1,
        "SELECTION_PLAYER":1,
        "SELECTION_BAG":1,
        "SYSTEM_UI":0,
        "SYSTEM_TIME":1,
        "SYSTEM_WEATHER":2,
        "SYSTEM_SKY":2,
    }
```

### 系统环境

* 系统环境的可选类型为["UI","时间","天气","天空"]。

```Javascript
    [ 
        0,          //主类型，[系统，附属物,玩家，背包...]其中的一个值
        0,          //系统可支配系统，[UI，天气，天空...]其中的一个值
        3,          //选中属性设置,这个之后，就是链式选中属性
    ]
```

### 附属物

* 附属物是在Block上部署的各种可扩展的物件，通过修改对应的属性来实现互动。
* 附属物的可选类型，根据world的实际加载情况进行处理。
* 附属物的选择，包括plugin，因其为自定义的附属物，操作逻辑一致。

```Javascript
    [ 
        1,          //主类型，[系统，附属物,玩家，背包...]其中的一个值
        0x00a1,     //附属物的short编号
        0,          //附属物的index，其中的一个附属物选中
        1,          //附属物属性设置选中,这个之后，就是链式选中属性
        2           
    ]
```

### 玩家

* 玩家的可选择属性 ["位置","旋转","身体","区块","运动能力","血量","魔法量"]

```Javascript
    [ 
        2,          //主类型，[系统，附属物,玩家，背包...]其中的一个值
        1,          //玩家可选属性的编号
        1,          //玩家属性设置选中,这个之后，就是链式选中属性
        2           
    ]
```

### 背包

* 背包内可选择属性 ["种类","数量"]。

```Javascript
    [ 
        3,          //主类型，[系统，附属物,玩家，背包...]其中的一个值
        1,          //玩家属性设置选中,这个之后，就是链式选中属性     
    ]
```

## 触发器事件

* 触发器的事件列表 ["进入","离开","停留","触碰",...]

## 判断方式

* 判断方式支持列表 ["不等于","等于","大于","小于","大于等于","小于等于"]

## 修改方式

* 不同类型的**属性及对象选择**会有不同的修改方式
* 数据修改的方式列表 ["设置","叠加","随机"]

### 系统环境修改

* UI,
* 天空,
* 天气,

### 附属物修改

### 玩家修改

### 背包修改

* 背包修改涉及到玩家的资产，其删除操作，只限于在进入游戏状态之后获取到的物品

## 工作流程

* 触发器使用这样的运行逻辑：**触发器事件** -->  **判断条件** --> **执行动作** --> **退出条件** --> **恢复动作**
* 使用上面提到的**属性及对象选择**和**判断方式**的定义，来实现**条件**的判断
* 使用上面提到的**属性及对象选择**和**修改方式**的定义，来实现**动作**的执行

### 判断条件

* 基础的数据结构为 ["对象属性","判断方式","目标值","触发执行"]。
* 判断条件为数组结构，所有条件为true，才执行下一步动作
* 当设置**触发执行**时，只要该条件为true,就开始**执行动作**。

### 执行动作

* 基础的数据结构为 ["对象属性","修改方式","目标值"]。

### 退出条件

* 基础的数据结构为 ["对象属性","判断方式","目标值","触发退出"]。
* 退出条件为数组结构，所有条件满足为true，执行**恢复动作**。
* 当设置**触发退出**时，只要该条件为true,执行**恢复动作**。

### 恢复动作

* 基础的数据结构为 ["对象属性","目标值"]。如不设置**目标值**，即将**对象**恢复到触发前的状态。
* 如果不设置恢复动作，则将**对象**保持在现有状态

## 实现原理

* 按照触发器的设置，系统将创建一个**function**用来实现对应的功能。
* 触发时，会对所有涉及到的**对象**进行缓存，已备恢复之用。