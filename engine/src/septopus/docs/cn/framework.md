# Septopus World引擎说明

## 基础说明

* Septopus坐标系如下图所示，XY轴为`地块`的方向，Z轴为`玩家`站立的方向。不同于`three.js`的默认坐标系。

|  Septopus坐标   | Three.js坐标  |
|  ----  | ----  |
| ![Septopus坐标系](../images/ax.septopus.svg)  | ![Three.js坐标系](../images/ax.three.js.svg) |

* Septopus提供单一程序，支持以下模式

|  模式   | 主要作用  |
|  ----  | ----  |
| 正常浏览  | 注册用户的模式，可以使用`形象`，能触发`机关` |
| 鬼魂模式  | 非注册用户的模式，可以游荡，但不能互动 |
| 编辑模式  | 对`地块`数据进行编辑的模式，只能对单一地块进行编辑 |
| 游戏模式  | 进入游戏的模式，只触发游戏涉及的`地块`内的`机关`，预渲染所有涉及的地块 |

* Septopus数据结构设计部分，采用多种`中间态标准`,例如组件数据、输入组件等。这样可以适应不同的网络存储及不同的渲染前端，提高引擎的兼容性。

* Septopus深度利用区块链的特性，根据区块高度来计算Septopus的`时间`，根据区块哈希来调整Septopus的`天气状态`。从而让数据具有可呈现的时间属性。未来，对3D物体，还可以根据时间进行显旧处理。

* Septopus支持多种区块链网络，合约部分依靠外部引入进行支持，不受网络限制。初期版本部署在Solana网络，依赖其便利的链上数据存储和高速响应。

* 采用单例模式进行开发，适用于单一视口渲染，更符合Septopus World的应用场景，有利于优化性能。带来的问题是在多窗口显示Septopus内容时，开发复杂度较高。

## 程序结构

* Septopus引擎，主要由以下几个部分构成。各部分功能独立，是一种松耦合的状态。

|  组成部分   | 主要作用  |
|  ----  | ----  |
| 框架部分  | `地块`数据管理；`世界`数据管理 |
| 渲染器  | 3D渲染;2D渲染 |
| 控制器  | 3D控制(手机端，PC端);2D控制(手机端，PC端) |
| 输入输出  | 基础UI;区块链网络连接; |
| 插件  | 扩展功能; |

* Septopus引擎使用帧同步计算方式，将需要处理的数据和功能，和帧更新同步，减少等待的卡顿，保障3D运行的流畅。例如，需要网络加载资源时，会保持数据，每帧进行一次网络请求。数据请求成功，也是在每帧处理一个资源的解析。

### 框架部分

* 世界运行入口
* 组件注册功能
* 帧同步实现
* 全局数据
* 模式切换
* 数据更新
* 异步数据获取
* 配置管理
* 常量定义管理
* 运行环境检测
* 地块解析
* 触发事件管理
* 运动控制
* 玩家信息管理
* 内部时间计算
* 气候条件计算

### 渲染器

* 3D渲染器
* 2D渲染器

### 控制器

* 3D第一人称控制
* 3D观察者模式控制
* 2D地图控制

### 输入输出

* UI框架
* API管理

### 插件

* 外部链接组件
* 二维码显示组件