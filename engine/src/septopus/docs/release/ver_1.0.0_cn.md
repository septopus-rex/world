# Septopus World引擎细节

* `Septopus World`游戏引擎，是一个和区块链技术深度绑定的游戏引擎。
* `Septopus World`游戏引擎主要用于实现Septopus的愿景，详见[https://septopus.xyz](https://septopus.xyz)。
* 当前版本为**V1.0.0**，初步体验版本。
* 该版本主要是实现完整可运行的3D世界，主要有以下几个方面。
    1. 全链理念的落地，无论是数据还是程序，都是部署于链上的。
    2. 完整可以运行的3D世界，可以直观的理解`Septopus World`在做什么。
    3. 高可扩展性的**附属物**的程序结构确认下来
    4. 不同的运行模式，用于解决不同的运行场景。所有的操作在同一个界面里完成，降低用户的心智负担。

## 核心功能

### 世界

* `Septopus World`启动入口。
* 系统的加载流程，从Holder的数据开始显示，在加载链上数据之后，逐步更新3D显示。
* 设置UI，交互逻辑组织。

### 框架

* 数据的管理，方便不同组件之间共享。
* 组件的管理，可扩展和版本更新的组件，数据定义都放链上。
* `Septopus World`执行逻辑的实现。
* 不同模式支持，可以在同一个世界实现不同的功能，支持创建小游戏。

### 时间、气候和天空

* `Septopus World`的独立时间体系。
* `Septopus World`气候体系，依赖区块的哈希，建立不可控的气候体系。
* `Septopus World`的天空管理，根据不同的时间和气候来设置天空的状况。

### 地块

* 地块是承载`Septopus World`的核心组件，可独立交易。
* 地块是定位3D内容的基础，附属物都依赖其进行定位。

### 玩家和运动

* `Septopus World`玩家控制，记录玩家的位置信息，保存在前端。
* `Septopus World`运动能力控制，运动的基本参数。
* 基本运动功能的支持，例如，跌落、死亡等。

### 事件系统

* `Septopus World`内置事件系统，用于处理系统状态的变化、玩家位置变化等。
* `Septopus World`事件需要进行预定义，目前不支持自定义事件。

### 环境检测

* 检测`Septopus World`的运行环境，如系统信息、屏幕尺寸等。

## 渲染器

### 3D组件封装 ( three.js )

* 创建3D环境物体的基础库，精简到只有`ThreeObject.get`和`ThreeObject.mesh`两个调用方法。

### 3D渲染器

* 对`Septopus World`进行3D渲染，管理场景及场景内3D物品，实现3D显示功能。
* 动态加载链上模型，防止网络阻塞出现卡顿。
* 设置天空、太阳等基础组件，完整显示`Septopus World`。

### 2D渲染器

* 对`Septopus World`进行2D渲染，主要用于显示2D地图。

### 观察者渲染器

* 该版本未开发。

## 控制器

### 第一人称控制器

* `Septopus World`默认控制器，第一人称视角，支持键盘鼠标和触屏操作。

### 2D控制器

* `Septopus World`2D控制器，主要用于2D地图的操作。

### 观察者控制器

* 该版本未开发。

## 功能库

### 触发机关构造器

* 解析`触发器`数据生成可执行的函数的基础库。
* 分离需要链上加载的数据，预处理后再进行`触发器`构造。

### 运算函数集

* 点和多边形关系计算。
* 阻挡关系计算。
* 两点距离计算。
* 点吸附计算。

### 屏幕触控库

* 多种屏幕操作支持，列表如下：["doubleTap","touchStart","touchMove","touchEnd","swipe","swipeLeft","swipeRight","swipeUp","swipeDown","gestureStart","gestureMove","gestureEnd"]。
* 对外仅`Touch.on`和`Touch.off`，方便使用。

### 2D绘制库

* 使用Canvas实现的2D绘制库。

### 工具箱

* 常用功能合集。

## 输入输出

### 用户界面

* 支持多种UI形式，列表如下：["toast","pop","dialog","menu","compass","status","form","sidebar","countdown"]。
* 支持UI重写，实现独立的统一UI。
* 输入表格部分，支持多种数据类型。列表如下：["number","integer","string","text","select"]。

### 数据源

* `Septopus World`获取外部数据的组件。
* 支持对`Septopus World`不同类型数据的获取。方法列表如下：["world","view","module","texture","subcribe","off"]。
* 合约请求的方法，挂载在这里，请求位置`Datasource.contract.*`。

## 附属物

### 阻拦体(stop)

* 阻挡玩家移动的组件，基础组件之一。
* 支持多种形状，当前版本仅支持`立方体(box)`。
* 不同于附属物设置的stop属性，这是独立的不可见组件。

### 触发器(trigger)

* 触发场景内事件的组件，基础组件之一。
* 支持多种形状，当前版本仅支持`立方体(box)`。
* 触发器可以调用系统资源，实现显示对话框等功能。

### 盒子(box)

* 在3D场景显示一个立方体的组件。
* 支持不同的贴图。
* 支持stop属性，可以阻挡玩家运动。
* 支持不同的动画。列表如下：[]。

### 外部模型(module)

* 在3D场景显示外部导入模型。
* 支持stop属性，可以阻挡玩家运动。
* 支持不同的文件类型。列表如下：["FBX","3DS"]。
* 支持不同的动画。列表如下：[]。

### 灯光(light)

* 在3D场景显示额外灯光的组件。
* 支持不同类型的灯光。列表如下：["spotlight","pointlight","directlight"]。

### 墙体(wall)

* 在3D场景显示墙体的组件。
* 墙体自动落地。
* 墙体支持开洞，本版本尚未支持。
* 支持stop属性，可以阻挡玩家运动。

## 插件

### 二维码(QR)

* 在3D场景显示二维码点阵的组件。
* 支持多种动态效果。

### 链接(link)

* 在3D场景显示超链接的组件。
* 支持点击后跳转到外部页面。